angular.module('iui.general', ['iui.generalTemplates','iui.filters','iui.pageHeader','iui.profileImage','iui.minlength','iui.mustMatch','iui.inputFieldHighlight','iui.alerts']);
var iuiAlertsModule = angular.module('iui.alerts', ['iui.filters']);
/*doc
---
title: iui-alert-placeholder
name: iui-alert-placeholder
category: Directives
---
Directive that creates a placeholder area for alerts generated by `iuiAlertService`.

The id is used as the unique identifier for the iuiAlertService.
Always prefix the id with `alert_` like `alert_wizardStep`
This prefix allows us to easily identify alerts in the codebase

Alerts with `type: warning` (red color) should never have a timeout.

```html_example
<iui-alert-placeholder id="alert_exampleArea"></iui-alert-placeholder>
<div ng-controller="AlertController as alertMain">
  <button
    class="btn btn-default"
    ng-click="alertMain.iuiAlertService.add('alert_exampleArea', { type: 'info', activeFor: 4000, canClose: true, message: 'Ah, it\'s the old... trick.'})">
    Trigger Example Area Alert (4 second timeout)
  </button>
  <button
    class="btn btn-default"
    ng-click="alertMain.iuiAlertService.add('alert_appTop', { type: 'danger', message: 'Pardon me while I get my shoe phone.'})">
    Trigger App Top Alert
  </button>
  <button
    class="btn btn-default"
    ng-click="alertMain.iuiAlertService.clear('alert_exampleArea')">
    Hide Example Area Alert
  </button>
  <button
    class="btn btn-default"
    ng-click="alertMain.iuiAlertService.clearAll()">
    Hide ALL Alerts
  </button>
</div>
```

```js_example
app.controller('AlertController', ['iuiAlertService', function(iuiAlertService) {
  this.iuiAlertService = iuiAlertService;
}]);
```
*/

/* directive for displaying alerts in a specific area */

iuiAlertsModule.directive('iuiAlertPlaceholder', ['iuiAlertService', function (iuiAlertService) {
  'use strict';
  return {
    restrict: 'E',
    scope: {},
    templateUrl: app.root + '$iui-general/alerts/iui-alert-placeholder.html',

    link: function(scope, element, attrs) {
      var alertId = attrs.id;
      iuiAlertService.clear();
      iuiAlertService.addPlacement(alertId);
      scope.placementAlerts = iuiAlertService.getCurrent(alertId);

      scope.closeAlert = function() {
        iuiAlertService.closeAlert(alertId);
      };
    }

  };
}]);

iuiAlertsModule.factory('iuiAlertService', ['$timeout', function (timeout) {
  'use strict';
  var defaultTimeOut = 20000,
    placements = {},
    callback = '',
    DEFAULT_PLACEMENT = 'alert_appTop';

  return {

    getCurrent: function (id) {
      return placements[id || DEFAULT_PLACEMENT];
    },

    addPlacement: function (id) {
      if (!placements[id]) {
        placements[id] = {};
      }
    },

    /* add alert */
    add: function (placement, alertObject) {

      var type = alertObject.type, 
        message = alertObject.message, 
        activeFor = alertObject.activeFor || 0, 
        callback = alertObject.callback,
        canClose = alertObject.canClose;
      
      placement = placement || DEFAULT_PLACEMENT;
      var currentPlacement = placements[placement];
      if(!currentPlacement){
        currentPlacement = placements[placement] = {};
      }

      // if the message is an error, it does not need a timeout
      if (type === 'danger') {
        activeFor = 0;
      }

      currentPlacement.callback = callback;

      currentPlacement.alert = {
        type: type,
        message: message,
        placement: placement,
        activeFor: activeFor,
        canClose: canClose,
        close: function () {
          return asvc.closeAlert();
        }
      };

      if (currentPlacement.promise) {
        timeout.cancel(currentPlacement.promise);
      }

      if (activeFor === 0) {
        return;
      }

      currentPlacement.promise = timeout(function () {
        currentPlacement.alert = {};
        if (currentPlacement.callback) {
          currentPlacement.callback();
        }
      }, (activeFor !== undefined) ? activeFor : defaultTimeOut);

    },

    /* close alert */
    closeAlert: function (id) {
      var placement = this.getCurrent(id);
      placement.alert = {};
      timeout.cancel(placement.promise);
      if (placement.callback){
        placement.callback();
      }
    },

    clearAll: function () {
      _.each(placements, function(placement) {
        placement.alert = {};
        timeout.cancel(placement.promise);
      });
    },

    /* clear alert */
    clear: function (id) {
      if (id) {
        var current = this.getCurrent(id);
        if(!current){
          return;
        }
        current.alert = {};
        timeout.cancel(current.promise);
      } else {
        this.clearAll();
      }
      
    }

  };

}]);
var iuiFiltersModule = angular.module('iui.filters', []);
/*doc
---
title: gender
name: gender
category: Filters
---

Filter to translate Communicate Gender number into Unknown, Male (2), or Female (3)

```html_example
<div ng-controller="GenderFilterExampleController as example">
  <dl class="dl-horizontal dt-as-left-aligned short-list">
    <dt>Name</dt>
    <dd>{{example.profile.name}}</dd>
    <dt>Gender</dt>
    <dd>{{example.profile.gender | gender}}</dd>
  </dl>
</div>
```

```js_example
app.controller('GenderFilterExampleController', [function() {
  this.profile = {
    name: 'Agent 99',
    gender: 3
  };
}]);
```
*/

iuiFiltersModule.filter('gender', [function () {
  'use strict';
  return function (input) {
    var parsedInput = parseInt(input);
    if (parsedInput === 2) {
      return 'Male';
    } else if (parsedInput === 3) {
      return 'Female';
    } else {
      return 'Unknown';
    }
  };
}]);

/*doc
---
title: to_trusted
name: to_trusted
category: Filters
---

Filter to "trust" the HTML source. This is useful for binding HTML from the API.
Please use caution when using this filter. If you find yourself storing bits and
pieces of HTML in a service or controller, consider using an `ng-include` or a `directive` instead.

```html_example
<div ng-controller="ToTrustedController as example">
  <span ng-bind-html="example.quote | to_trusted"></span>
</div>
```

```js_example
app.controller('ToTrustedController', [function() {
  // This is strictly an example. Please do not store HTML in Javascript files
  this.quote = '<blockquote><em>Good thinking, Max.</em> &mdash; <strong>Agent 99</strong></blockquote>';
}]);
```
*/

// This filter allows you to use ng-bind-html when html is coming from the API
iuiFiltersModule.filter('to_trusted', ['$sce', function($sce){
  'use strict';
  return function(text) {
    return $sce.trustAsHtml(text);
  };
}]);

angular.module('iui.breadcrumb', [])
.directive('iuiBreadcrumb', [function () {
  'use strict';
  return {
    restrict: 'E',
    scope: {
      breadcrumb: '='
    },
    templateUrl: app.root + '$iui-general/iui-breadcrumb/iui-breadcrumb.html'
  };
}]);

/*doc
---
title: iui-input-field-highlight
name: iui-input-field-highlight
category: Directives
---

This directive, iui-input-field-highlight, looks for the focus state
on various input types, and applies a bg color change to keep the
user's attention on the section. It also separates each section without
the use of borders.

```html_example
<section class="panel panel-default" iui-input-field-highlight>
  <div class="panel-body">
    <div class="form-group">
      <input
        class="form-control"
        aria-label="Field 1"
        placeholder="Field 1"
        type="text">
    </div>
    <div class="form-group">
      <input
        class="form-control"
        aria-label="Field 2"
        placeholder="Field 2"
        type="text">
    </div>
  </div>
</section>
<section class="panel panel-default" iui-input-field-highlight>
  <div class="panel-body">
    <div class="form-group">
      <input
        class="form-control"
        aria-label="Field 3"
        placeholder="Field 3"
        type="text">
    </div>
    <div class="form-group">
      <input
        class="form-control"
        aria-label="Field 4"
        placeholder="Field 4"
        type="text">
    </div>
  </div>
</section>
```
*/



angular.module('iui.inputFieldHighlight', [])
.directive('iuiInputFieldHighlight', function() {
  'use strict';
  return {
    restrict: 'A',
    scope: {},
    link: function(scope, element) {
      var sectionWrapper = element;
      var inputSearchTypes ='input, textarea, select, div, button, a, table';
      scope.$watch(function() {
        scope.allInputsSize = sectionWrapper.find(inputSearchTypes).size();
      });
      scope.$watch('allInputsSize', function(newVal) {
        var allInputs = sectionWrapper.find(inputSearchTypes);
        allInputs.on('focus', function() {
          sectionWrapper.addClass('is-highlighted');
        });
        allInputs.on('blur', function() {
          sectionWrapper.removeClass('is-highlighted');
        });
      });
    }
  };
});

/*doc
---
title: iui-minlength
name: iui-minlength
category: Directives
---
Angular's minlength directive does not $observe or $eval the value of ngMinlength in Angular 1.2

```html_example
<div class="form-group" ng-form name="minlengthExample">
  <input
    class="form-control"
    aria-label="Text field 1"
    name="textField1"
    placeholder="This field has 10 character minlength"
    type="text"
    ng-model="iuiTextField"
    iui-minlength="10">
  <p ng-show="minlengthExample.textField1.$error.minlength">Field must contain 10 characters</p>
</div>
```
*/


angular.module('iui.minlength', [])
.directive('iuiMinlength',function(){
  'use strict';
  return {
    require: 'ngModel',
    link: function(scope,elm,attr,ngModel){

      var minlength = 0;

      var minLengthValidator = function(value){
        var validity = ngModel.$isEmpty(value) || value.length >= minlength;
        ngModel.$setValidity('minlength',  validity);
        return validity ? value : undefined;
      };

      attr.$observe('iuiMinlength', function(val){
         minlength = parseInt(val,10);
         minLengthValidator(ngModel.$viewValue);
      });


      ngModel.$parsers.push(minLengthValidator);
      ngModel.$formatters.push(minLengthValidator);
    }
  };
});

/*doc
---
title: iui-must-match
name: iui-must-match
category: Directives
---
Provides validation when two fields need to be the same (like matching passwords)

```html_example
<fieldset ng-form name="mustMatchExample">
  <legend class="sr-only">Field 1 must match Field 2</legend>
  <div class="form-group">
    <input
      class="form-control"
      aria-label="Text field 1"
      name="matchTextField"
      placeholder="This is the origination field"
      type="text"
      ng-model="iuiMatchTextField1">
  </div>
  <div class="form-group">
    <input
      class="form-control"
      aria-label="Text field 2"
      name="matchTextField2"
      placeholder="This field must match the field above"
      type="text"
      iui-must-match="iuiMatchTextField1"
      ng-model="iuiMatchTextField2">
    <p class="help-block" ng-if="mustMatchExample.matchTextField2.$error.mustMatch">This field must match the field above</p>
  </div>
</fieldset>
```
*/


angular.module('iui.mustMatch', [])
.directive('iuiMustMatch', [function () {
  'use strict';
  return {
    restrict: 'A',
    require: 'ngModel',
    link: function(scope, elem, attr, ngModel) {
      var comparison;
      var checkValidation = function(comparisonModel, currentModel) {
        ngModel.$setValidity('mustMatch', comparisonModel === currentModel);
      };

      scope.$watch(attr.iuiMustMatch, function(newVal) {
        comparison = newVal;
        checkValidation(comparison,ngModel.$modelValue);
      });

      //For DOM -> model validation
      ngModel.$parsers.unshift(function(value) {
         checkValidation(comparison,value);
         return value;
      });

      //For model -> DOM validation
      ngModel.$formatters.unshift(function(value) {
        checkValidation(comparison,value);
        return value;
      });
    }
  };
}]);

/*doc
---
title: iui-page-header
name: iui-page-header
category: Directives
---
General page header to be used on every page

```html_example
<div ng-controller="pageHeaderController">
  <iui-page-header breadcrumb="breadcrumb" heading-text="{{headingText}}"></iui-page-header>
</div>
```
```js_example
app.controller('pageHeaderController', ['$scope', function(scope) {
  scope.breadcrumb = [
    {name: 'Health Information', url: '/my-health-information/'},
    {name: 'Health Trackers', url: '/my-health-information/health-trackers/'}
  ];
  scope.headingText = 'This is a page header';
}]);
```
*/
angular.module('iui.pageHeader', ['iui.breadcrumb'])
.directive('iuiPageHeader', [function() {
    'use strict';
    return {
        restrict: 'E',
        scope: {
            headingText: '@',
            breadcrumb: '='
        },
        templateUrl: app.root + '$iui-general/iui-page-header/iui-page-header.html'
    };
}]);

/*doc
---
title: iui-profile-image
name: iui-profile-image
category: Directives
---
for showing profile images

<table class="table responsive">
  <caption>Options for iui-stepper</caption>
  <thead>
    <tr>
      <th>Attribute</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>iui-image</code></td>
      <td>String</td>
      <td>image data in a base64 string</td>
    </tr>
    <tr>
      <td><code>iui-gender</code></td>
      <td>Integer</td>
      <td>gender of individual. 0 for undefined, 1 for male, 2 for female</td>
    </tr>
  </tbody>
</table>

## Dependencies
<code>genderFilter</code>

```html_example
<iui-profile-image class="user-image" iui-image="profile.image" iui-gender="profile.gender"></iui-profile-image>
<iui-profile-image class="user-image" iui-image="" iui-gender="profile.gender"></iui-profile-image>
```
*/

angular.module('iui.profileImage', ['iui.filters'])
.directive('iuiProfileImage', ['genderFilter', function(genderFilter) {
    'use strict';
    return {
      restrict: 'E',
      scope :{
        iuiImage: '=',
        iuiGender: '=',
        iuiIsThumb: '=',
        iuiIsSquare: '='
      },
      templateUrl: app.root + '$iui-general/iui-profile-image/iui-profile-image.html',
      controller: function ($scope, genderFilter) {
        $scope.$watch('iuiGender', function(newVal) {
          $scope.profileGender = genderFilter(newVal);
        });
      }
    };
}]);

/*

Service to update menus in routes.json file

*/

angular.module('iui.menuService', [])
.factory('MenuService',['$q', function MenuServiceFactory($q) {
  'use strict';
  var deferred = $q.defer();
  return {
    menus: deferred.promise,
    setMenus: function(menus) {
      deferred.resolve(menus);
    },
    getMenus: function() {
      return this.menus;
    },
    // gets the moduleTitle based on the moduleInstanceId
    getModuleTitle: function (moduleInstanceId) {
      return this.getMenus().then(function (menus) {
        if (menus.navigation) {
          return _.findWhere(menus.navigation, {ModuleInstanceId: moduleInstanceId}).Name;
        }
      });
    },
    // updates the app.routes populated from the routes.json file with proper titles for each module
    updateRouteTitles: function (menus) {
      _.each(app.routes, function (route) {
        _.each(menus, function (menuItem) {
          if (menuItem.ModuleId && route.moduleId && menuItem.ModuleId.trim().toUpperCase() === route.moduleId.trim().toUpperCase()) {
            route.title = menuItem.Name;
          }
        });
      });
    }
  };
}]);

(function(module) {
try {
  module = angular.module('iui.generalTemplates');
} catch (e) {
  module = angular.module('iui.generalTemplates', []);
}
module.run(['$templateCache', function($templateCache) {
  $templateCache.put('/$iui-general/alerts/iui-alert-placeholder.html',
    '<div \n' +
    '  ng-if="placementAlerts.alert.message" \n' +
    '  class="alert-wrapper">\n' +
    '    <div \n' +
    '      class="alert alert-{{placementAlerts.alert.type}}" \n' +
    '      role="alert">\n' +
    '	    <span \n' +
    '	    	class="alert-message" \n' +
    '	    	ng-bind-html="placementAlerts.alert.message | to_trusted">\n' +
    '	    </span>\n' +
    '	    <button \n' +
    '	    	ng-if="placementAlerts.alert.canClose"\n' +
    '	    	type="button" \n' +
    '	    	class="close" \n' +
    '	    	aria-label="Close" \n' +
    '	    	ng-click="closeAlert()">\n' +
    '	    	<span aria-hidden="true">&times;</span>\n' +
    '	    </button>\n' +
    '    </div>\n' +
    '</div>');
}]);
})();

(function(module) {
try {
  module = angular.module('iui.generalTemplates');
} catch (e) {
  module = angular.module('iui.generalTemplates', []);
}
module.run(['$templateCache', function($templateCache) {
  $templateCache.put('/$iui-general/iui-breadcrumb/iui-breadcrumb.html',
    '<nav role="navigation" class="iui-breadcrumb-nav" ng-if="breadcrumb.length">\n' +
    '	<p class="sr-only" id="breadcrumblabel">You are here:</p>\n' +
    '	<ol class="iui-breadcrumb" aria-labledby="breadcrumblabel">\n' +
    '		<li ng-repeat="crumb in breadcrumb">\n' +
    '			<a ng-href="{{crumb.url}}" class="page-breadcrumb" title="{{crumb.name}}" ng-bind="crumb.name"></a>\n' +
    '		</li>\n' +
    '	</ol>\n' +
    '</nav>\n' +
    '');
}]);
})();

(function(module) {
try {
  module = angular.module('iui.generalTemplates');
} catch (e) {
  module = angular.module('iui.generalTemplates', []);
}
module.run(['$templateCache', function($templateCache) {
  $templateCache.put('/$iui-general/iui-page-header/iui-page-header.html',
    '<iui-breadcrumb breadcrumb="breadcrumb"></iui-breadcrumb>\n' +
    '<div class="page-main-heading">\n' +
    '  <h1 class="page-header">{{headingText}}</h1>\n' +
    '</div>\n' +
    '');
}]);
})();

(function(module) {
try {
  module = angular.module('iui.generalTemplates');
} catch (e) {
  module = angular.module('iui.generalTemplates', []);
}
module.run(['$templateCache', function($templateCache) {
  $templateCache.put('/$iui-general/iui-profile-image/iui-profile-image.html',
    '<span class="profile-image-wrap" ng-class="{\'profile_square\':iuiIsSquare, \'profile_rounded\':!iuiIsSquare, \'profile_thumb\':iuiIsThumb, \'profile_male\': profileGender === \'Male\',  \'profile_female\': profileGender === \'Female\', \'profile_unknown\':(profileGender !== \'Male\' && profileGender !== \'Female\')}">\n' +
    '	<span\n' +
    '		ng-if="iuiImage != \'data:image/jpeg;base64,null\' && iuiImage != null"\n' +
    '		ng-style="{\'background-image\':\'url(data:image/jpeg;base64,\'+iuiImage+\')\'}"\n' +
    '		class="profile_image">\n' +
    '	</span>\n' +
    '	<span\n' +
    '		class="profile_image"\n' +
    '		ng-if="!(iuiImage != \'data:image/jpeg;base64,null\' && iuiImage != null)"\n' +
    '		ng-include="\'/$iui-general/images/profile-unknown.svg\'">\n' +
    '	</span>\n' +
    '</span>\n' +
    '');
}]);
})();

(function(module) {
try {
  module = angular.module('iui.generalTemplates');
} catch (e) {
  module = angular.module('iui.generalTemplates', []);
}
module.run(['$templateCache', function($templateCache) {
  $templateCache.put('/$iui-general/images/profile-unknown.svg',
    '<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\n' +
    '	 width="540px" height="540px" viewBox="0 0 540 540" enable-background="new 0 0 540 540" xml:space="preserve">\n' +
    '<g>\n' +
    '	<g>\n' +
    '		<path class="icon" fill="#D5D5D5" d="M540,540v-73.281c-21.952-10.43-44.013-20.639-66.434-29.951c-25.871-10.753-47.868-25.665-64.646-48.162\n' +
    '			c-2.067-2.764-4.553-5.488-7.425-7.32c-5.18-3.306-9.539-5.738-9.231-13.711c0.27-6.911,4.892-9.59,7.509-14.277\n' +
    '			c4.345-7.766,6.86-16.794,8.843-25.58c1.947-8.647,2.271-17.659,3.379-27.124c12.707,2.388,16.532-7.023,18.476-14.995\n' +
    '			c4.529-18.592,7.301-37.622,10.36-56.542c0.361-2.246-2.098-4.863-2.938-7.412c-0.772-2.34-1.678-4.843-1.576-7.235\n' +
    '			c0.911-20.996,3.354-42.02,2.773-62.964c-0.804-28.999-9.344-55.563-32.068-75.715c-18.591-16.484-40.638-25.805-64.566-31.145\n' +
    '			c-6.266-1.399-12.662-2.202-18.999-3.279h-1.612c-6.602,1.053-13.245,1.905-19.798,3.192c-20.483,4.023-41.024,7.945-54.7,26.325\n' +
    '			c-0.962,1.293-3.768,1.455-5.77,1.695c-22.469,2.69-31.076,18.677-35.567,37.9c-4.327,18.499-4.718,37.267-1.83,56.147\n' +
    '			c2.586,16.863,4.56,33.822,6.486,48.375c-2.509,6.494-6.75,11.897-5.994,16.476c3.373,20.425,7.957,40.664,12.58,60.859\n' +
    '			c1.481,6.46,5.832,9.907,14.087,5.9c1.262,7.88,2.777,14.949,3.455,22.103c1.392,14.628,2.448,28.928,17.963,37.024\n' +
    '			c6.08,3.171,3.65,19.322-3.003,20.404c-14.29,2.316-20.425,12.799-25.954,23.886c-6.19,12.414-15.345,20.793-28.292,26.049\n' +
    '			c-21.399,8.687-42.603,17.907-63.532,27.666c-20.937,9.756-41.666,20.023-62.062,30.86c-17.726,9.416-26.303,24.913-26.734,45.049\n' +
    '			c-0.062,2.928-0.146,5.855-0.228,8.783H540z"/>\n' +
    '	</g>\n' +
    '</g>\n' +
    '</svg>\n' +
    '');
}]);
})();
